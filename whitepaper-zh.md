# DeFi评估：无许可贷款协议的风险评估 <br/> 
## [tl;dr]<br/>
本文介绍一个无许可贷款协议（Permissionless Lending Protocols）的风险水平评估模型。为了展现这些协议平台中存在的各种风险，我们使用了一个多因素模型来研究智能合约、抵押品、流动性和中心化的风险。该模型混合了公链中链上和链下的数据来更好地评估不同的、基于以太坊的无许可贷款协议产品的相对风险水平。<br><br/>

## 目录
  - [DeFi评估：无许可贷款协议的风险评估](#DeFi评估：无许可贷款协议的风险评估)
  - [tl;dr](#tldr)
  - [目录](#目录)
  - [简介](#简介)
  - [无许可贷款协议概述](#无许可贷款协议概述)
    - [智能合约风险](#智能合约风险)
      - [代码安全](#代码安全)
      - [代码开放](#代码开放)
    - [金融属性风险](#金融属性风险)
      - [抵押品](#抵押品)
      - [流动性](#流动性)
    - [中心化风险](#中心化风险)
      - [密钥管理](#密钥管理)
      - [预言机](#预言机)
  - [公式分解](#公式分解)
  - [局限](#局限)
    - [DAI存款利率](#DAI存款利率)
  - [未来的改善](#未来的改善)
  - [参考](#参考)
  - [贡献者](#贡献者)
    - [主要贡献者:](#主要贡献者)
    - [更多的贡献者:](#更多的贡献者)
  - [社区](#社区)
  - [许可](#许可)
## 简介
中本聪创立比特币的主要动力是2008年的金融危机。他在比特币的创世区块（Genesis Block）提到了当时的银行救助计划（注1）。一些人认为，金融危机部分原因是由于金融界对整个金融体系信贷风险的误解和错误定价造成的。风险管理是现代金融中最关键的部分之一，它为我们建立了一个更加稳健和安全的金融体系。<br><br>
在过去的一年里，我们看到了以太坊上无许可的金融协议爆炸式增长，其中很大一部分集中在借贷市场。这些市场已发展成为“去中心化金融”或“DeFi”中的最大子类别，年增长率达355% （注2）。然而，并非所有的借贷平台都是一样的。不同的无许可贷款产品具有非常不同的风险/回报，这使得仅比较它们的利率就好像比较苹果和桔子一样毫无意义。<br><br>
为了更好地理解和建模DeFi领域中的风险将是促使其走向成熟最重要的一步。有许多工作要做，但现在是开始的时候了。希望这个模型和其他类似的模型能够为DeFi进行稳健的风险评估奠定基础。<br><br>
在这里，我们引入了一个定量模型来评估这种无许可贷款协议（Permissionless lending protocols）中的风险水平。<br><br>
注1:</br>
https://www.blockchain.com/btc/tx/4a5e1e4baab89f3a32518a88c31bc87f618f76673e2cc77ab2127b7afdeda33b<br>
注2:</br>
根据DeFi Pulse贷款类目中总锁定价值（TVL）数据 <br><br>
## 无许可贷款协议概述<br><br>
无许可贷款协议是允许用户通过以太坊的“智能合约”借贷各种不同数字资产的系统。这些“智能合约”并不是法律意义上的合同；而是有效运行在以太坊链上的计算机代码。借出资产的用户将从其贷款中获得的利息。借款人提供抵押品（通常高于借款价值），并支付利息。无许可贷款协议的一些项目包括compound、dydx和nuo。<br><br>
### 智能合约风险<br><br>
在DeFi中，智能合约的风险是主要风险。尽管DeFi通常被称为去信任的(Trustless)，DeFi平台的用户必须信任正在与他们交互的智能合约，这意味着用户信任合约代码就像信任Web2.0的应用那样。但智能合约对用户来说可能是不透明/模糊的。还有一种风险是，智能合约由于不安全而遭到黑客攻击，这对合约中的用户产生严重的财务影响，包括，失去锁定在合约中的抵押品。我们提出的模型着眼于评估智能合约风险的这两个要素。<br><br>
### 代码安全<br><br>
当用户在与DeFi平台交互时存在丢失锁定在智能合约中的资金风险时，智能合约的安全性就显得非常重要。正如以太坊生态系统所受到的教训那样，智能合约中的错误可能导致重大的财务损失。例如，“DAO攻击”是针对“DAO”的项目发起的攻击，“DAO”是去中心自治组织的一种形式，即以太坊链上智能合约中体现的“虚拟”组织（注3）。2016年7月17日，一个未知的个人或团体从DAO快速转移大量ETH，导致大约360万ETH - DAO的1/3 ETH - 从DAO的地址转移到攻击者控制的地址。（注4）<br><br>
虽然任何智能合约都不能保证其是安全、没有错误的，但一个信誉良好的安全公司提供的彻底代码审计和形式化验证都将有助于严重错误的发现。缺陷赏金计划（Bug bounty programs）是另一个积极的体现，表明开发团队对安全的重视，用赏金的形式鼓励独立的安全研究人员发现协议代码的缺陷，最终形成更广泛的安全审查监督。<br><br>
我们的模型通过审查链下但公开的数据来评估代码的安全性：<br>
1.	代码审计：代码是否经过信誉良好的安全团队（consensys diligence，trail of bits，others）的审计？<br>
2.	形式化验证：代码是否已经由信誉良好的安全团队形式化验证。<br>
3.	赏金计划：开发团队是否提供公开详细的代码缺陷赏金计划。<br><br>
注3:</br>
Securities and Exchange Commission, Release No. 81207, https://www.sec.gov/litigation/investreport/34‐81207.pdf (“SEC DAO Report”) at 1.<br><br>
注4:</br>
DAO攻击中资金是通过以太坊区块链（ID）的一个特别的“分叉”收回的，但这种分叉不能指望能从未来的黑客行为中收回。<br><br>
### 代码开放<br><br>
DeFi承诺的一部分是，智能合约是完全在链上的，这意味着代码是透明且可验证的。虽然DeFi平台的开发人员仍然能够以各种方式隐藏他们的代码，例如不验证字节码和使用链下预言机（oracles）。这种模糊的安全性只能提供薄弱的安全保证，最坏的情况是会导致关键错误的被延迟发现。虽然字节码反编译是可能的，但这是一个困难和耗时的过程，并且很难遵循“不相信，只验证”的口号。<br><br>
代码开放性是通过审查链下的公共数据，来验证字节码是否被验证来评估。<br><br>
## 金融属性风险<br><br>
DeFi包含许多与传统金融相同的风险。虽然大多数无许可贷款平台使用了超额抵押来降低贷款的风险，但超额抵押并不能完全消除这样的无许可贷款的风险。因为我们都知道，现在的加密资产极不稳定，因此这些平台没能够拿这些不稳定的抵押资产来全部对冲借款。<br><br>
目前我们的模型着眼于金融属性风险的两个要素：<br><br>
### 抵押品<br><br>
目前为止，我们没有能识别和评估链上借款人声誉或身份的有效方法，所以在DeFi借贷市场上避免贷款风险的唯一方法就是使用超额抵押品。虽然目前所有平台都使用了这种非常保守的方法，但加密资产的高波动性的情况下，这些超额担保仍然不足。<br><br>
这些DeFi平台支持的抵押资产也有很大的差异，其中一些是流动性更高、更稳定的抵押品（注5）。例如，一个平台接受ETH抵押。虽然ETH仍然不是一种非常稳定的资产，但与link（注6）这样的资产相比，它相对稳定且流动性高。在考虑平台风险时，这些抵押品的差异是一个重要因素。<br><br>
我们的模型对抵押品风险是通过查看两个数据点来评估，这两个数据都能从链下数据派生出来的。第一个数据点是30天的平均抵押比率（EMA），在所有可用的贷款池中使用对数的离差标准化(Min-Max Normalization)。第二个是对抵押品组合的分析。一般情况下，EMA的计算方法如下：<br><br>
![defi-score](https://github.com/ConsenSys/defi-score/blob/master/assets/images/EMA.png)<br>
•	系数α表示权重降低的程度，是介于0和1之间的常数平滑因子。选择了2/31的平滑因子。<br>
•	Yt 是时间段t上的值。这是30，用于查找30天EMA <br>
•	St是任意时间段t上EMA的值。<br><br>
有许多不同的模型来评估抵押品组合的风险。最常见的模型之一是VaR（value at risk）模型。VaR模型有多种不同的变种。该模型目前最常用的是CVaR（条件风险价值）模型，也称为预期缺口模型。该方法使用CVaR而非VaR，因为CVaR更好地捕捉了称为黑天鹅的更极端情况下最双的可能损失。上图有助于证明这种差异——CVaR（ES）模型会导致更大的下降。由于加密资产的初级和极端波动性，该方法更为保守。模型采用99%置信水平CVaR模型，公式如下：<br><br>
![defi-score](https://github.com/ConsenSys/defi-score/blob/master/assets/images/cvar.png)<br>
![defi-score](https://github.com/ConsenSys/defi-score/blob/master/assets/images/histogram.png)<br>
该百分比越高即视为CVaR更差，因为这意味着较高比例的总抵押品处于风险之中。<br>
注5:</br>
根据coinmarketcap的数据，ETH在过去30天的交易量达到了1907亿美元，而link则仅达到了22亿美元。<br>
注6:</br>
根据Yahoo Finance的数据，在过去一年中，Link-USD 30天的年化波动率高达330，ETH-USD高达165。<br><br>
### 流动性<br><br>
当前平台都试图通过使用动态利率来激励流动性，动态利率模型根据每个资产池中的流动性水平产生出不同的利率。然而，激励流动性并不意味着能保证流动性。用户要承担风险，因为所有资产都已借出，在极端情况下他们将无法全部收回借出的资产。<br><br>
流动性风险的评估，是链上数据中的流动性的30天均线，使用所有可用贷款池中以美元表示的流动性金额的池中使用对数的离差标准化。使用流动性的绝对水平，而不是利用率的百分比（未偿债务/总资产），因为这有一个副作用，也会使较大的资金池得分更高。<br><br>

## 中心化风险
在使用DeFi贷款协议时，中心化风险是一个需要考虑的重要风险。不同的DeFi协议有不同程度的中心化风险，DeFi评分应尽量突出强调这些风险。

### 密钥管理
DeFi协议中心化风险的最大的表现在密钥的管理。密钥允许协议开发人员更改其智能合约系统的不同参数，如预言机/oracle、利率等。协议开发人员更改这些合约参数的能力，存在给用户造成经济损失的风险。但像Timelock和multisig/多签这样的措施有助于减轻由于密钥管理过于集中在开发团队而造成的财务损失风险。多签通过将密钥的控制权分配给更多的开发人员来帮助降低这种风险，这意味着单个密钥的丢失或泄露不会危及整个系统安全。Timelock有助于通过允许协议用户在改变发生之前退出他们的合约来降低风险。<br>

| 评分        | 描述           | 
| ------------ |-------------| 
| 1    | 密钥管理不带timelock  | 
| 2    | 密钥管理带timelock   |
| 3 | 密钥管理带timelock和multisig  |
| 4 | 无需密钥管理-自治/去中心化治理 | 

### 预言机
无许可贷款协议中心化风险的另一个重要部分存在于预言机/oracle的操控中心化。有许多不同类型的预言机/oracle系统被用来支持这些DeFi协议。有些协议使用完全自主操控的预言机/oracle系统来获取链外数据，而另一些即使用外部操控的中心化预言机/oracle，如Uniswap和Kyber。Samczun关于预言机的设计和他们会造成的经济损失能力提供了很好的背景资料。预言机的集中化评分并不关注这些链外价格数据上链是否可操作（它们都是），而是评估单个实体是否可以轻松地操控它们。在中心化自操控模式，所有者就能操控其数据。去中心化的预言机即不存在少数实体能的操控的局面。但虽然上链的数据并不总是代表一项资产的公平市场价值，这就是为什么要在去中心化预言机之上建造的开发商选择使用价格波动边界来抵御这些类型的攻击。<br>

| 评分        | 描述           | 
| ------------ |-------------| 
| 1    | 只使用中心化的自控预言机 | 
| 2    | 使用混合了中心化和去中心化的预言机     |
| 3 | 只使用去中心化的预言机 |
| 4 | 不需要预言机 | 

## 公式分解<br><br>
1.	智能合约风险 (45%)<br>
•	代码审计 (25%)</br>
•	合约字节码解构 (10%)</br>
•	形式化的验证 (5%)</br>
•	缺陷赏金计划 (5%)<br><br>

2. 金融属性风险(30%)<br>
•	 抵押组合CVaR (10%)</br>
•	 利用率 /Utilization Ratio (10%)</br> 
•	 流动性风险 (10%)</br> 

3.	中心化风险(25%)</br>
•	密钥管理 (12.5%) <br>
•	预言机 (12.5%) <br><br>

## 局限<br><br>
这还不是一个有效的统计模型。没有足够的数据在产品范围内对此模型做过足够多的验证。这仅是一个观点性的评估框架，用于评估不同DeFi平台的相关风险。<br><br>
这种评估方法是基于相对短期（不到一年）的投资质量意见。这些建议也不能对投资规模大小作区别对待，但这可能对流动性风险产生重大影响。该方法仍处于早期阶段，我们评级系统期待大家更正更新及反馈。<br><br>
我们这种方法试图在相对的而不是绝对的基础上，比较不同的DeFi借贷市场平台风险。这是其他DeFi货币市场平台与传统金融投资（如存款账户）之间的比较。DeFi领域还很新，如果没有丰富的历史数据，就更难做出前瞻性的表述。<br><br>

__此模型不考虑与这些产品相关的许多其他风险，如清算政策风险。__<br><br>

### DAI 存款利率
尽管该模型是专门为贷款协议而设计的，但是通过DAI储蓄率赚钱的能力是一个非常重要的赚钱机会，我们强烈地感到应该对它进行评分并将其包含在我们的参考python实现中。尽管我们计划设计一个更适合这个（有些独特的）的机会模型，但在此仅对DSR做一个初步评分。以下是它的分数：

| 类别   |  评分   |
| ---------- | ------- |
| 智能合约风险 | 45/45 |
| 金融属性风险 | 30/30 |
| 中心化风险 | 21.875/25 |
| **合计** | **96.875/100** |  

注释:
* 因为DSR的智能合约已经通过审计，字节码验证，形式化验证，并且有一个完整的bug缺陷赏金计划，所以它获得了“智能合约风险”的完美分数
* DeFi 评分中的“金融属性风险”不适用于DSR提供的盈利机会。正因为如此，DSR得到了这个类别的完美分数。
* 因为该协议有一个带有timelock和multisig的密钥管理，并且不需要预言机，所以它获得“中心化风险”25%评分中的7/8.


## 未来的改善<br><br>
这个模型还有很多工作要做，这是早期研究。这个模型需要更多的微调及验证。在这个模型中还需要包括其他相关风险，如清算政策风险。其中一些很难量化，这就是为什么它们没有包含在初始迭代中的原因。<br><br>
最后，将这些评估要素分解成各自的、更精确的评分算法是很有意义的。这样子要素就能组合成不同类型的区块链金融产品。未来能覆盖的范围包括额外的DeFi收益类产品（如set）、合成资产产品（如maker和uma）、做市产品（如uniswap）以及对冲这些产品的各种Cefi (中心化金融) 相对应的产品。<br><br>
另一个最终目标是提供一个API接口与其他评估算法互动，这样其他第一层和第二层DeFi产品就可以利用这个API。这将有助于输出研究和教育用户。<br><br>
这个评估方法一开始就在Github上开源，最终目标是希望通过去中化的社区治理来确定评估的因子和因子的权重。<br><br>
这项研究的最终目标是将所有的工作集中到一种DAO模式中去，像一个开源的信用评级机构那样，确定方法并支助工程师，风险管理专家和对此有贡献的其他人或机构把它实现。虽然需要在不同的时空完成的风险管理的工作会令人望而生畏，但我们对未来感到兴奋。<br><br>
<br><br>
## 参考<br><br>
1. Evans, Alex. “A Ratings-Based Model for Credit Events in MakerDAO.” A Ratings-Based Model for Credit Events in MakerDAO. Placeholder VC, July 2019. https://static1.squarespace.com/static/5a479ee3b7411c6102f75729/t/5d37587d026881000198ef51/1563908221879/Maker-Ratings.pdf.</br>
2. Nakamoto, Satoshi. “Bitcoin Genesis Block.” Blockchain, January 3, 2009. https://www.blockchain.com/btc/tx/4a5e1e4baab89f3a32518a88c31bc87f618f76673e2cc77ab2127b7afdeda33b?show_adv=true.</br>
3. Callagy, Robert, Vanessa Robert, Marc Pinto, and Daniel Marty. “Money Market Funds.” Money Market Funds. New York, NY: Moody's Investor Service, 2019.<br><br>
<br><br>
